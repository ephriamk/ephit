# Deploying EphItUp to Render

## Overview
EphItUp is configured for deployment on Render using Docker. This guide will help you deploy your customized version.

## Deployment Steps

### 1. Push to GitHub
First, commit and push your changes to GitHub:

```bash
cd open-notebook
git add .
git commit -m "Update to EphItUp with vibrant liquid glass design"
git push origin main
```

### 2. Deploy to Render

#### Option A: Using Render Dashboard (Recommended)

1. Go to [Render Dashboard](https://dashboard.render.com)
2. Click "New +" → "Blueprint"
3. Connect your GitHub repository
4. Render will detect the `render.yaml` file automatically
5. Review the configuration and click "Apply"

#### Option B: Using Render CLI

```bash
render deploy
```

### 3. Environment Variables

Set these environment variables in Render:

**Required:**
- `OPENAI_API_KEY` - Your OpenAI API key (keep this secret!)
- `SURREAL_PASSWORD` - Auto-generated by Render or set manually

**Optional:**
- `API_URL` - Auto-set by Render (your service URL + /api)
- `SURREAL_URL` - Default: "ws://localhost:8000/rpc"
- `SURREAL_USER` - Default: "root"
- `SURREAL_NAMESPACE` - Default: "open_notebook"
- `SURREAL_DATABASE` - Default: "production"

### 4. Database Configuration

The app uses SurrealDB, which is embedded in the single container. Data persists in the `/mydata` directory.

**For production with external database:**
- Create a separate SurrealDB service on Render
- Update `SURREAL_URL` to point to your external database

### 5. Build Configuration

**Build Command:**
```bash
docker build -f Dockerfile.single -t ephitup .
```

**Start Command:**
```bash
/usr/bin/supervisord -c /etc/supervisor/conf.d/supervisord.conf
```

### 6. Port Configuration

The app exposes two ports:
- **8502** - Frontend (Next.js)
- **5055** - API (FastAPI)

Render will automatically map port 8502 as the main service port.

### 7. Post-Deployment

After deployment:

1. **Access your app**: `https://your-service-name.onrender.com`
2. **Check logs**: View logs in Render dashboard
3. **Set API key**: Add your OpenAI API key in environment variables
4. **Test**: Create a notebook to verify functionality

## Architecture

### Single Container Setup
The Dockerfile.single creates one container with:
- SurrealDB (embedded database)
- FastAPI backend (port 5055)
- Next.js frontend (port 8502)
- All managed by Supervisord

### Services Running

```
Container
├── SurrealDB (port 8000)
├── FastAPI API (port 5055)
├── Worker process
└── Next.js Frontend (port 8502)
```

## Environment Variables Reference

| Variable | Purpose | Default | Required |
|----------|---------|---------|----------|
| `OPENAI_API_KEY` | OpenAI API access | None | Yes |
| `SURREAL_URL` | Database connection | `ws://localhost:8000/rpc` | No |
| `SURREAL_USER` | Database user | `root` | No |
| `SURREAL_PASSWORD` | Database password | Generated | No |
| `SURREAL_NAMESPACE` | DB namespace | `open_notebook` | No |
| `SURREAL_DATABASE` | DB name | `production` | No |
| `API_URL` | Frontend API URL | Auto-detected | No |

## Troubleshooting

### Build Fails
- Check Render logs for errors
- Ensure Dockerfile.single exists
- Verify frontend builds successfully

### App Won't Start
- Check environment variables are set
- Verify OPENAI_API_KEY is valid
- Check logs for SurrealDB errors

### Database Issues
- Database files persist in `/mydata`
- SurrealDB runs on localhost:8000 inside container
- Check logs for connection errors

### Frontend Issues
- API_URL must be set correctly
- Check network tab for failed requests
- Verify both ports are accessible

## Security Notes

1. **Never commit API keys** to the repository
2. Use Render's environment variables for secrets
3. Enable HTTPS (automatic on Render)
4. Consider adding authentication layer
5. Restrict database access if using external DB

## Scaling

The `starter` plan includes:
- 512MB RAM
- 1 vCPU
- 100GB bandwidth

For higher traffic, upgrade to `standard` or `pro` plans.

## Updates

To update your deployment:

```bash
git push origin main
```

Render will automatically rebuild and redeploy.

## Custom Domain

To add a custom domain:
1. Go to Render Dashboard
2. Select your service
3. Settings → Custom Domains
4. Add your domain
5. Update DNS records

## Monitoring

Monitor your app:
- View logs in real-time
- Set up alerts for downtime
- Check build history
- Monitor resource usage

## Support

- [Render Docs](https://render.com/docs)
- [Open Notebook Docs](https://github.com/lfnovo/open-notebook)
- Check logs in Render dashboard

