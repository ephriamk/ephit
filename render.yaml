services:
  - type: web
    name: ephitup
    runtime: docker
    dockerfilePath: ./Dockerfile.single
    dockerContext: .
    # Memory Plan Recommendations:
    # - starter (512MB): Tight fit for 4 services. May fail under load. Good for testing only.
    # - standard (2GB): Recommended for production. Stable with all features enabled.
    # - pro (4GB): Best for heavy usage (many users, large notebooks, podcast generation)
    plan: starter
    healthCheckPath: /
    # Persistent disk storage - REQUIRED for data persistence across deploys
    # SurrealDB stores database at /mydata/mydatabase.db
    # Also stores encryption keys at /mydata/.secrets/
    # Cost: $0.25/GB per month (10GB = $2.50/month, 20GB = $5/month)
    disk:
      name: ephitup-data
      mountPath: /mydata
      sizeGB: 10  # Start with 10GB. Increase if you have lots of documents/podcasts
    envVars:
      # Optional: System-level API keys (users can add their own keys in Settings)
      # These are only used as fallback - users can add keys via UI at /settings
      # - key: OPENAI_API_KEY
      #   sync: false
      
      # Security (Auto-generated - JWT by Render, Fernet by app to persistent storage)
      - key: JWT_SECRET
        generateValue: true
      # FERNET_SECRET_KEY is auto-generated by the app on first run and saved to /mydata/.secrets/fernet.key
      # This ensures it persists across deployments without manual setup
      
      # Optional: AWS S3 for podcast audio storage
      - key: S3_BUCKET_NAME
        sync: false
      - key: S3_ENDPOINT_URL
        sync: false
      - key: AWS_ACCESS_KEY_ID
        sync: false
      - key: AWS_SECRET_ACCESS_KEY
        sync: false
      - key: S3_REGION
        value: "us-east-2"
      
      # Database Configuration
      - key: SURREAL_URL
        value: "ws://localhost:8000/rpc"
      - key: SURREAL_USER
        value: "root"
      - key: SURREAL_PASSWORD
        generateValue: true
      - key: SURREAL_NAMESPACE
        value: "open_notebook"
      - key: SURREAL_DATABASE
        value: "production"
      
      # Frontend Configuration
      # PORT is automatically set by Render to a dynamic value
      # Frontend reads it from environment and binds to that port
      - key: INTERNAL_API_URL
        value: "http://localhost:5055"
      
      # Worker Configuration (Optional)
      # Set to "false" to disable worker and save ~100MB RAM on tight deployments
      # Worker handles: podcast generation, embeddings rebuild, long-running tasks
      # You can enable it later by changing this to "true" and redeploying
      - key: ENABLE_WORKER
        value: "true"
